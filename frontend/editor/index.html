<!DOCTYPE html>
<html>
<!-- Include stylesheet -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link rel="stylesheet" href="styles.css">

<body>


<h1>Editor</h1>

<div  class="editor">

    <div id="annotations" class="annotation">

    
    <p style="border: 1px solid #d8d8d8;">
        <script>
            getData();
            async function getData() {
                console.log('da');
                const res = await fetch('/notes');
                const data = await res.json();

                for (item of data) {
                    const newAnnot = document.createElement('div');
                    const passage = document.createElement('a');
                    const note = document.createElement('p');
                    const strPassage = document.createTextNode(`${item.passage}`);
                    const strNote = document.createTextNode(`${item.annotation}`);


                    newAnnot.setAttribute("id", `${item._id}`);
                    note.setAttribute("draggable", "true");
                    note.setAttribute("ondragstart", `drag(event)`);
                    note.setAttribute("class", "annot-note")
                    passage.setAttribute("class", "annot-pass")
                    newAnnot.setAttribute("class", "element");

                    passage.appendChild(strPassage);
                    note.appendChild(strNote);
                    newAnnot.appendChild(passage);
                    newAnnot.appendChild(note);

                    // const butt = document.createElement('button');
                    // butt.setAttribute("onclick", `insertCitation("${item._id}")`)
                    // butt.textContent = "insert";
                    document.getElementById("annotations").append(newAnnot);
                }
            }

        </script>
    </p>
    </div>
    
<!-- Create the editor container -->
<div class="document">
    <div id="editor" ondrop="drop(event)">
        <p>Hello World!</p>
        <p>Some initial <strong>bold</strong> text</p>
        <p><br></p>
      </div>
</div>



<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<!-- Initialize Quill editor -->
<script>
  var quill = new Quill('#editor', {
    theme: 'snow'
  });

  function getCursorPosition() {
    var range = quill.getSelection();
    if (range) {
        if (range.length == 0) {
            console.log('User cursor is at index', range.index);
            return range.index;
        } else {
            var text = quill.getText(range.index, range.length);
            console.log('User has highlighted: ', text);
        }
    } else {
        console.log('User cursor is not in editor');
    }
}

    function insertCitation(noteId) {
        var note = document.getElementById(noteId).innerHTML; 
        console.log(getCursorPosition()); 
        quill.insertText(getCursorPosition(), note, 'italic', true); 
        return note; 
    }

    function drag(dragevent) {
        var text = dragevent.target.innerHTML
        dragevent.dataTransfer.setData("text", text);
        console.log(dragevent.dataTransfer);
        dragevent.target.style.color = 'green';
    }
    
    function drop(dropevent) {
        dropevent.preventDefault();
        var note = dropevent.dataTransfer.getData("text");
        console.log(note);
        quill.insertText(getCursorPosition(), note, 'italic', true); 


        // dropevent.target.appendChild(document.getElementById(data));
        // document.getElementById("drag").style.color = 'black';
    }




</script>

</body>

</html>