<!-- Include stylesheet -->
<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8" />
        <title>prototype</title>
        <!-- Import Styles -->
        <link rel="stylesheet" href="../styles.css" />
        <!-- Import Vue.js -->
        <script src="https://unpkg.com/vue@3.0.0-beta.12/dist/vue.global.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
    </head>


<body>
    <div id="app2" class="editor">

        <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
        <div id="annotations">
            <!--
            <button @click="getData">Documents</button>
            <ed-annotation-display v-for="item of database" :passage="${item.passage}"></ed-annotation-display>-->
            

        
        <p style="border: 1px solid #d8d8d8;">
            <script>
                getData();
                async function getData() {
                    const res = await fetch('/api');
                    const data = await res.json();

                    for (item of data) {
                        const text = document.createElement('div');
                        text.textContent = `${item.passage}`;
                        text.setAttribute("id", `${item._id}`);
                        text.setAttribute("draggable", "true");
                        text.setAttribute("class", "box");
                        const butt = document.createElement('button');
                        butt.setAttribute("onclick", `insertCitation("${item._id}")`)
                        butt.textContent = "insert";
                        document.body.append(text, butt);
                    }
                }

                document.addEventListener('DOMContentLoaded', (event) => {
  
                    function handleDragStart(e) {
                        this.style.opacity = '0.4';   
                    }
                    
                    function handleDragEnd(e) {
                        this.style.opacity = '1';
                    }
                    
                    function handleDragOver(e) {
                        if (e.preventDefault) {
                        e.preventDefault();
                        }
                        
                        return false;
                    }

                    function handleDragEnter(e) {
                        this.classList.add('over');
                    }

                    function handleDragLeave(e) {
                        this.classList.remove('over');
                    }
                    
                    let draggeds = document.querySelectorAll('.editor .box');
                    draggeds.forEach(function(dragged) {
                        dragged.addEventListener('dragstart', handleDragStart, false);
                        dragged.addEventListener('dragover', handleDragOver, false);
                        dragged.addEventListener('dragenter', handleDragEnter, false);
                        dragged.addEventListener('dragleave', handleDragLeave, false);
                        dragged.addEventListener('dragend', handleDragEnd, false);
                    });
                    });
            </script>
        </p>


        </div>

        <!-- Create the editor container -->
        <div id="editor">
        <p>{{ zero }}</p>
        <p>Some initial <strong>bold</strong> text</p>
        <p><br></p>
        </div>


        <!-- Include the Quill library -->
        <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>


        <!-- Initialize Quill editor -->
        <script>
        var quill = new Quill('#editor', {
            theme: 'snow'
        });

        function getCursorPosition() {
            var range = quill.getSelection();
            if (range) {
                if (range.length == 0) {
                    console.log('User cursor is at index', range.index);
                    return range.index;
                } else {
                    var text = quill.getText(range.index, range.length);
                    console.log('User has highlighted: ', text);
                }
            } else {
                console.log('User cursor is not in editor');
            }
        }

        function insertCitation(noteId) {
            var note = document.getElementById(noteId).innerHTML; 
            console.log(getCursorPosition()); 
            quill.insertText(getCursorPosition(), note, 'italic', true); 
            return note; 
        }

        </script>

        <script src="./textEditor.js"></script>
        


        <script>
            const mountedApp = app.mount('#app2')
        </script>

    </div>

</body>

</html>