<!DOCTYPE html>
<html>
<!-- Include stylesheet -->
<title>Polylets editor</title>

<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="./jszip-master/dist/jszip.js"></script>
<script type="text/javascript" src="FileSaver.js-master/dist/FileSaver.js"></script>

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link rel="stylesheet" href="styles.css">

<body>

    <div class="navigationBar">
        <a href="../viewer">Viewer</a>
        <a>Editor</a>
        <a href="../reader">Reader</a>
        <a href="../table">Table</a>
    </div>

    <div style="margin:0px 0px 0px 10px">
        <h1>Document Editor</h1>
        <button id="save-button" class="button">Save</button>
    
    </div>

        

    <div class="editor">

        <div id="annotations" class="annotation">

            <p style="border: 1px solid #d8d8d8;">
                <script>
                    getData();
                    async function getData() {
                        console.log('da');
                        const res = await fetch('/notes');
                        const data = await res.json();

                        for (item of data) {
                            const newAnnot = document.createElement('div');
                            const passage = document.createElement('a');
                            const note = document.createElement('p');
                            const strPassage = document.createTextNode(`${item.passage}`);
                            const strNote = document.createTextNode(`${item.annotation}`);

                            newAnnot.setAttribute("id", `${item._id}`);
                            newAnnot.setAttribute("draggable", "true");
                            newAnnot.setAttribute("ondragstart", `drag(event)`);

                            newAnnot.setAttribute("data-fileid", `${item.fileId}`);
                            newAnnot.setAttribute("data-startOffset", `${item.startOffset}`)
                            newAnnot.setAttribute("data-endOffset", `${item.endOffset}`)
                            newAnnot.setAttribute("data-startIndex", `${item.startIndex}`)
                            newAnnot.setAttribute("data-endIndex", `${item.endIndex}`)

                            note.setAttribute("class", "annot-note");
                            passage.setAttribute("class", "annot-pass");
                            newAnnot.setAttribute("class", "element");

                            passage.appendChild(strPassage);
                            note.appendChild(strNote);
                            newAnnot.appendChild(passage);
                            newAnnot.appendChild(note);

                            // const butt = document.createElement('button');
                            // butt.setAttribute("onclick", `insertCitation("${item._id}")`)
                            // butt.textContent = "insert";
                            document.getElementById("annotations").append(newAnnot);
                        }
                    }
                </script>
            </p>
        </div>

        <button id="save-button" class="button">Save</button>
            
        <!-- Create the editor container -->
        <div class="document">
            <div id="editor" ondrop="drop(event)">
                <p>Hello World!</p>
                <p>Some initial <strong>bold</strong> text</p>
                <p><br></p>
            </div>
        </div>
    </div>

    <script src="script.js"></script>

</body>

</html>